#--------------------------------------------
# ◇Chapter17　本管理アプリ：ファイルのアップロード機能を追加する
#--------------------------------------------



#**************************************************
# 1.  booksテーブルにファイル名カラムを追加
#**************************************************
/database/migrations/******create_books_table.php を変更（リスト17.1）
#--------------------------------------------
#カラムを追加します。

$table->string('item_img');     //Add:item_img

#[END]--------------------------------------------




#**************************************************
# ２. テーブルを再構築
#**************************************************

php artisan migrate:refresh

#[END]--------------------------------------------




#**************************************************
#３．FORM開始タグにenctype属性（enctype="multipart/form-data"）を追加（リスト17.2）
#**************************************************

<form enctype="multipart/form-data" action="{{ url('books') }}"method="POST" class="form-horizontal">

#[END]--------------------------------------------




#**************************************************
#４．ファイル選択を追加（本の登録ボタンの上くらいに）（リスト17.3）
#**************************************************

 <div class="col-sm-6">
    <label>画像</label>
    <input type="file" name="item_img">
</div>

#[END]--------------------------------------------




#**************************************************
#５．ファイルを表示：HTML表示箇所に埋め込む（本のタイトルが表示される場所付近に）（リスト17.4）
#**************************************************
#/resources/views/books.blade.php

<div> <img src="upload/{{$book->item_img}}" width="100"></div>

#[END]--------------------------------------------





#**************************************************
#６．コントローラ「BooksController@store」に追加（リスト17.5）
#**************************************************
# データ登録処理の上に記述しておくこと

  $file = $request->file('item_img'); //file取得
  if( !empty($file) ){                //fileが空かチェック
      $filename = $file->getClientOriginalName();   //ファイル名を取得
      $move = $file->move('../upload/',$filename);  //ファイルを移動：パスが“./upload/”の場合もあるCloud9
  }else{
      $filename = "";
  }

#[END]--------------------------------------------





#**************************************************
#７．コントローラ「BooksController@store」を修正（リスト17.5）
#**************************************************
#登録処理に１行追加

  $books->item_img = $filename;

#[END]--------------------------------------------




#**************************************************
#８．/public/以下にuploadフォルダを空で作成（このフォルダにアップロードする）
#**************************************************
# /public/upload の階層構造になるようにフォルダを作成










