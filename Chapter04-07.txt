#--------------------------------------------
# ◇Chapter4 ~ 7
#--------------------------------------------

#--------------------------------------------
# ◇Chapter4　練習アプリ：本管理アプリを作る
#--------------------------------------------

#--------------------------------------------
#１.envファイルのDB設定 （リスト4.1）
#--------------------------------------------
DB_HOST=localhost
DB_DATABASE=c9
DB_USERNAME=root
DB_PASSWORD=root
------
# 1.2 [.env] 設定を変更したら「必ずWebサーバーを再起動」です！！
↓  ↓  ↓  ↓  ↓

[Ctrl] + [C]キーでWebサーバーを止めます。

php artisan serve --port=8080

↑　↑　↑　↑　↑
-------
#１.[完了]DB接続設定完了***
#  ＜重要＞間違うと「データ構造を作成（テーブル作成）」の次章でError!になります。


#--------------------------------------------
# ◇Chapter5　本管理アプリ：データベースにテーブルを作成する
#--------------------------------------------

#--------------------------------------------
#２. booksテーブルを作成用の「マイグレーションファイル作成」
#--------------------------------------------

#cmsディレクトリに入って実行
cd cms

#Migrationファイル作成
php artisan make:migration create_books_table --create=books

#２.[完了]Tableを作成するMigrationファイルを作成 完了***




#--------------------------------------------
#３．[年]_[月]_[日]_[時分秒]_create_books_table.php
#   /database/migrations/以下にこのファイルは作成されます。
#   public function up(){...}の中を修正（リスト5.4）
#--------------------------------------------
public function up()
    {
        Schema::create('books', function (Blueprint $table) {
            $table->bigIncrements('id');
            //--ここから追加--
            $table->string('item_name');
            $table->integer('item_number');
            $table->integer('item_amount');
            $table->datetime('published');
            //--ここまで追加--
            $table->timestamps();
        });
}

#３．[完了]Table作成するスクリプト準備 完了***




#--------------------------------------------
#４．/app/Providers/AppServiceProvider.php［ファイルを修正］（リスト5.5）
#--------------------------------------------

use Illuminate\Support\Facades\Schema; //この行を追加
use Illuminate\Support\Facades\URL;    //この行を追加
public function boot() {
   {・・・略・・・}
   Schema::defaultStringLength(191);   //boot()内に、この行を追加
   URL::forceScheme('https');          //boot()内に、この行を追加
   {・・・略・・・}
}

#４．[完了]ファイル修正完了***




#--------------------------------------------
#５．マイグレーションファイルを実行（テーブルを作成！！）
#--------------------------------------------

php artisan migrate

#５.[完了]Table作成スクリプト実行 完了***




#--------------------------------------------
#６.MySQL DBに作成されたテーブルを確認
#--------------------------------------------
# MySQLコマンドで確認

mysql -u root -p
root [Enter]キー 　#「root」と入力してもカーソルは動かないので、気にせず打ち込む！エラー出たら再度！！
use c9;
show tables;
desc books;        #テーブル構造を確認します (図5.5)
exit;

#６．[完了]Table作成をMySQLコマンドで確認 完了***


#--------------------------------------------
# ◇Chapter6　本管理アプリ：モデルを作成する
#--------------------------------------------

#--------------------------------------------
#７．モデルを作成（テーブルを簡単に扱えるようにする機能）
#--------------------------------------------
#cmsフォルダに入ってください
cd cms

#モデル作成
php artisan make:model Book

#７.[完了]DBを簡単に操作するためのファイルを作成 完了***


#--------------------------------------------
#８．モデルを作成（テーブルを簡単に扱えるようにする機能）
#   /app/Book.php に作成されます。
#--------------------------------------------

#８.[完了]/app/Book.phpにファイルができて完了***




#*********************************************************************************
# ここまでが初期設定
#
# ここからアプリを作っていきます
#*********************************************************************************


#--------------------------------------------
# ◇Chapter7 本管理アプリ：ルート定義を作成する
#--------------------------------------------

#**************************************************
# ９．ルート定義（ルーティング）
#**************************************************
routes/web.php に 以下コードを貼り付けます（リスト7.1）。
#--------------------------------------------
#以下[END]までの全てのコードをコピーして全てを上書きます。

<?php
use App\Book;
use Illuminate\Http\Request;

/**
* 本の一覧表示(books.blade.php)
*/
Route::get('/', function () {
    return view('welcome');
});

/**
* 本を追加 
*/
Route::post('/books', function (Request $request) {
    //
});

/**
* 本を削除 
*/
Route::delete('/book/{book}', function (Book $book) {
    //
});


#[END]--------------------------------------------





